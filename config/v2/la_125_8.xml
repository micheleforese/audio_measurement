<procedure name="LA-125" comment="Test per la macchina LA-125">

  <steps>

    <serial_number>
      <text>ID Device:</text>
    </serial_number>

    <default>
      <sweep>
        <config>
          <sampling>
            <Fs_multiplier>50</Fs_multiplier>
            <points_per_decade>50</points_per_decade>
            <frequency_min>10</frequency_min>
            <frequency_max>99999</frequency_max>
            <number_of_samples>200</number_of_samples>
            <delay_measurements>0</delay_measurements>
          </sampling>
          <nidaq>
            <channel comment="Ref">cDAQ9189-1CDBE0AMod5/ai1</channel>
            <channel comment="DUT">cDAQ9189-1CDBE0AMod5/ai3</channel>
          </nidaq>
        </config>
      </sweep>
    </default>


    <task name="PRE_G1">
      <set_level name="master" comment="">
        <dBu modifier="yes">4</dBu>
        <config>
          <nidaq>
            <Fs_max>1000000</Fs_max>
            <voltage_min>-10</voltage_min>
            <voltage_max>10</voltage_max>
            <channel>cDAQ9189-1CDBE0AMod5/ai1</channel>
          </nidaq>
          <sampling>
            <Fs_multiplier>50</Fs_multiplier>
            <number_of_samples>200</number_of_samples>
          </sampling>
        </config>
      </set_level>


      <sweep name="PRE_G1" comment="Flat, NO 48V">
        <config>
          <rigol>
            <amplitude key="master" />
          </rigol>
        </config>
      </sweep>

      <calculation>
        <dB_insertion_gain name="referenced_dut_gain" comment="DUT - Ref Gain in Db">
          <sweepVoltageDb key="PRE_G1" idx="1" />
          <sweepVoltageDb key="PRE_G1" idx="0" />
        </dB_insertion_gain>

        <insertion_phase name="referenced_dut_phase" comment="DUT - Ref Phase in degrees">
          <sweepVoltageDb key="PRE_G1" idx="1" />
          <sweepVoltageDb key="PRE_G1" idx="0" />
        </insertion_phase>

        <plot kind="gain-phase">
          <data>
            <sweepVoltageLocal key="referenced_dut_gain" />
            <sweepVoltageLocal key="referenced_dut_phase" />
          </data>
          <config>
            <plot>
              <legend>
                <Db sweep_name="PRE_G1">{sweep.name} {sweep.comment}</Db>
              </legend>
              <title>
                <Db test_name="LA-125">{test.name} {test.comment} {test.date}</Db>
              </title>
            </plot>
          </config>
        </plot>
      </calculation>
    </task>

    <task name="PRE_G5">
      <set_level name="master" comment="">
        <dBu modifier="yes">4</dBu>
        <config>
          <nidaq>
            <Fs_max>1000000</Fs_max>
            <voltage_min>-10</voltage_min>
            <voltage_max>10</voltage_max>
            <channel>cDAQ9189-1CDBE0AMod5/ai1</channel>
          </nidaq>
          <sampling>
            <Fs_multiplier>50</Fs_multiplier>
            <number_of_samples>200</number_of_samples>
          </sampling>
        </config>
      </set_level>


      <sweep name="PRE_G5" comment="Flat, NO 48V">
        <config>
          <rigol>
            <amplitude key="master" />
          </rigol>
        </config>
      </sweep>

      <calculation>
        <dB_insertion_gain name="referenced_dut_gain" comment="DUT - Ref Gain in Db">
          <sweepVoltageDb key="PRE_G5" idx="1" />
          <sweepVoltageDb key="PRE_G5" idx="0" />
        </dB_insertion_gain>

        <insertion_phase name="referenced_dut_phase" comment="DUT - Ref Phase in degrees">
          <sweepVoltageDb key="PRE_G5" idx="1" />
          <sweepVoltageDb key="PRE_G5" idx="0" />
        </insertion_phase>

        <plot kind="gain-phase">
          <data>
            <sweepVoltageLocal key="referenced_dut_gain" />
            <sweepVoltageLocal key="referenced_dut_phase" />
          </data>
          <config>
            <plot>
              <legend>
                <Db sweep_name="PRE_G5">{sweep.name} {sweep.comment}</Db>
              </legend>
              <title>
                <Db test_name="LA-125">{test.name} {test.comment} {test.date}</Db>
              </title>
            </plot>
          </config>
        </plot>
      </calculation>
    </task>


  </steps>
</procedure>